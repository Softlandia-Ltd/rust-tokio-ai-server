(()=>{"use strict";var e={52:function(e,t,s){var r=s(848),a=s(540),n=s(338);function i(e){let t=[],s="",r="";for(let t of e.split("\n"))t.startsWith("event:")?s=t.slice(6).trim():t.startsWith("data:")&&(r+=t.slice(5)+"\n");return s&&r&&t.push({event:s,data:r.replace(/\n$/,"")}),t}async function o(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},s=arguments.length>2?arguments[2]:void 0,r=new Headers(t.headers||{});s&&r.set("X-User-ID",s),r.has("Content-Type")||r.set("Content-Type","application/json");let a=await fetch("http://localhost:3000"+e,{...t,headers:r});if(!a.ok){let e=await a.text();throw Error(`${a.status} ${a.statusText}: ${e}`)}return a}async function l(e){let t=await o("/conversations",{method:"GET"},e);return(await t.json()).conversations}async function d(e,t,s,r){var a;let n=null==(a=(await o("/conversations",{method:"POST",headers:{Accept:"text/event-stream"},body:JSON.stringify({message:t})},e)).body)?void 0:a.getReader();if(!n)throw console.error("No SSE stream"),Error("No SSE stream");let l=new TextDecoder("utf-8"),d="";for(;;){let e,{done:t,value:a}=await n.read();if(t)break;for(d+=l.decode(a,{stream:!0});-1!==(e=d.indexOf("\n\n"));){let t=d.slice(0,e);for(let{event:a,data:n}of(d=d.slice(e+2),i(t)))if("new_message"===a)try{let e=JSON.parse(n);console.log("[SSE] new_message:",e),s(e)}catch(e){console.error("Failed to parse new_message:",n)}else if("message_part"===a)try{let e=JSON.parse(n);console.log("[SSE] message part:",e),r(e)}catch(e){console.error("Failed to parse message part:",n)}}}}async function c(e,t){let s=await o(`/conversations/${t}/messages`,{method:"GET"},e);return(await s.json()).messages}async function u(e,t,s,r,a){var n;let l=null==(n=(await o(`/conversations/${t}/messages`,{method:"POST",headers:{Accept:"text/event-stream"},body:JSON.stringify(s)},e)).body)?void 0:n.getReader();if(!l)return void console.error("No SSE stream");let d=new TextDecoder("utf-8"),c="";for(;;){let e,{done:t,value:s}=await l.read();if(t)break;for(c+=d.decode(s,{stream:!0});-1!==(e=c.indexOf("\n\n"));){let t=c.slice(0,e);for(let{event:s,data:n}of(c=c.slice(e+2),i(t)))if("new_message"===s)try{let e=JSON.parse(n);console.log("[SSE] new_message:",e),r(e)}catch(e){console.error("Failed to parse new_message:",n)}else if("message_part"===s)try{let e=JSON.parse(n);console.log("[SSE] message part:",e),a(e)}catch(e){console.error("Failed to parse message part:",n)}}}}function h(){return"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,function(e){let t=16*Math.random()|0;return("x"===e?t:3&t|8).toString(16)})}let x="userId",m=document.getElementById("root");m&&n.createRoot(m).render((0,r.jsx)(a.StrictMode,{children:(0,r.jsx)(()=>{let[e,t]=(0,a.useState)(null),[s,n]=(0,a.useState)([]),[i,o]=(0,a.useState)(null),[m,f]=(0,a.useState)([]),[v,p]=(0,a.useState)(""),[g,y]=(0,a.useState)(!1),[w,b]=(0,a.useState)({userMsg:null,placeholderId:null}),j=(0,a.useRef)(null);function S(e){return[...e].sort((e,t)=>{let s=e.created_at?new Date(e.created_at).getTime():0;return(t.created_at?new Date(t.created_at).getTime():0)-s})}function N(e){if(!e)return"";let t=new Date(e);return isNaN(t.getTime())?"":t.toLocaleString(void 0,{year:"numeric",month:"short",day:"numeric",hour:"2-digit",minute:"2-digit"})}(0,a.useEffect)(()=>{let e=function(e){let t=document.cookie.match(RegExp("(^| )"+e+"=([^;]+)"));return t?t[2]:null}(x);e||function(e,t){let s=arguments.length>2&&void 0!==arguments[2]?arguments[2]:365,r=new Date(Date.now()+864e5*s).toUTCString();document.cookie=`${e}=${t}; expires=${r}; path=/`}(x,e=h()),t(e)},[]),(0,a.useEffect)(()=>{e&&l(e).then(e=>n(S(e))).catch(()=>{})},[e]),(0,a.useEffect)(()=>{e&&i&&(f([]),c(e,i).then(e=>f(e.filter(e=>"System"!==e.kind))).catch(()=>f([])))},[e,i]),(0,a.useEffect)(()=>{var e;null==(e=j.current)||e.scrollIntoView({behavior:"smooth"})},[m]);let _=(0,a.useMemo)(()=>{let e=s.find(e=>e.id===i);return e&&(e.title||N(e.created_at))||"Conversation"},[s,i]),k=m.filter(e=>"System"!==e.kind);async function E(t){if(e&&t){y(!0);try{let s=h(),r={id:h(),conversation_id:s,kind:"User",text:t},a=h();b({userMsg:r,placeholderId:a}),f([r,{id:a,conversation_id:s,kind:"Bot",text:""}]);let i=null;if(await d(e,t,e=>{o(e.conversation_id),"User"===e.kind?f(t=>t.map(t=>t.id===r.id?e:t)):(i=e.conversation_id,b({userMsg:null,placeholderId:null}),f(t=>{let s=t.map(t=>t.id===a?e:t);s.find(t=>t.id===e.id)||(s=[...s,e]);let r=new Set,n=[];for(let e of s)r.has(e.id)||(n.push(e),r.add(e.id));return n}))},e=>{f(t=>{let s=t.findIndex(t=>t.id===e.message_id);if(-1!==s){let r=t.slice(),a=r[s];return r[s]={...a,text:(a.text||"")+e.message_part},r}return[...t,{id:e.message_id,conversation_id:e.conversation_id,kind:"Bot",text:e.message_part}]})}),i){let e=i;n(t=>S([{id:e,title:_},...t.filter(t=>t.id!==e)]))}}catch(e){b({userMsg:null,placeholderId:null}),f(e=>e.map(t=>{var s;return t.id===(null==(s=e.find(e=>"Bot"===e.kind))?void 0:s.id)?{...t,text:"(error receiving response)"}:t}))}finally{y(!1)}}}async function O(t,s){if(!e||!s.trim())return;y(!0);let r={id:h(),conversation_id:t,kind:"User",text:s};f(e=>[...e,r]);let a=h();f(e=>[...e,{id:a,conversation_id:t,kind:"Bot",text:""}]);try{await u(e,t,{text:s},e=>{"User"===e.kind?f(t=>t.map(t=>t.id===r.id?e:t)):f(t=>{let s=t.map(t=>t.id===a?e:t);s.find(t=>t.id===e.id)||(s=[...s,e]);let r=new Set,n=[];for(let e of s)r.has(e.id)||(n.push(e),r.add(e.id));return n})},e=>{f(t=>{let s=t.findIndex(t=>t.id===e.message_id);if(-1!==s){let r=t.slice(),a=r[s];return r[s]={...a,text:(a.text||"")+e.message_part},r}return[...t,{id:e.message_id,conversation_id:e.conversation_id,kind:"Bot",text:e.message_part}]})})}catch(e){f(e=>e.map(e=>e.id===a?{...e,text:"(error receiving response)"}:e))}finally{y(!1)}}let T=async()=>{let e=v.trim();e&&(p(""),i?await O(i,e):await E(e))};return(0,r.jsxs)("div",{className:"content",children:[(0,r.jsxs)("aside",{className:"sidebar",children:[(0,r.jsxs)("div",{className:"sidebar-header",children:[(0,r.jsx)("div",{className:"brand",children:"Local Chatbot"}),(0,r.jsx)("button",{className:"new-btn",onClick:function(){o(null),f([]),b({userMsg:null,placeholderId:null}),p("")},children:"New"})]}),(0,r.jsx)("div",{className:"convo-list",children:s.map(e=>(0,r.jsx)("div",{className:`convo-item ${i===e.id?"active":""}`,onClick:()=>o(e.id),children:e.title||N(e.created_at)||e.id},e.id))})]}),(0,r.jsxs)("section",{className:"chat-area",children:[(0,r.jsxs)("div",{className:"chat-header",children:[(0,r.jsx)("div",{children:i?_:"New conversation"}),(0,r.jsxs)("div",{style:{opacity:.6,fontSize:12},children:["User: ",e]})]}),i?(0,r.jsxs)(r.Fragment,{children:[(0,r.jsxs)("div",{className:"messages",children:[k.map(e=>(0,r.jsx)("div",{className:`message-row ${"User"===e.kind?"user":"bot"}`,children:(0,r.jsx)("div",{className:`bubble ${"User"===e.kind?"user":"bot"}`,children:e.text})},e.id)),(0,r.jsx)("div",{ref:j})]}),(0,r.jsxs)("div",{className:"input-bar",children:[(0,r.jsx)("textarea",{value:v,onChange:e=>p(e.target.value),placeholder:"Type your message...",onKeyDown:e=>{"Enter"!==e.key||e.shiftKey||(e.preventDefault(),T())}}),(0,r.jsx)("button",{className:"send-btn",disabled:g,onClick:T,children:"Send"})]})]}):w.userMsg?(0,r.jsxs)("div",{className:"messages",children:[(0,r.jsx)("div",{className:"message-row user",children:(0,r.jsx)("div",{className:"bubble user",children:w.userMsg.text})}),(0,r.jsx)("div",{className:"message-row bot",children:(0,r.jsxs)("div",{className:"bubble bot",children:[(0,r.jsx)("span",{children:"AI Assistant is thinking..."}),(0,r.jsx)("span",{className:"spinner",style:{marginLeft:8,display:"inline-block",verticalAlign:"middle"},children:(0,r.jsx)("svg",{width:"18",height:"18",viewBox:"0 0 18 18",fill:"none",xmlns:"http://www.w3.org/2000/svg",children:(0,r.jsx)("circle",{cx:"9",cy:"9",r:"8",stroke:"#22c55e",strokeWidth:"3",strokeDasharray:"24",strokeDashoffset:"8"})})})]})})]}):(0,r.jsx)("div",{className:"empty-state",children:(0,r.jsxs)("div",{className:"empty-card",children:[(0,r.jsx)("h2",{children:"Start a new conversation"}),(0,r.jsx)("p",{children:"Ask anything to your local AI assistant. Your data stays on your machine."}),(0,r.jsxs)("div",{className:"input-bar",style:{padding:0,borderTop:"none"},children:[(0,r.jsx)("textarea",{value:v,onChange:e=>p(e.target.value),placeholder:"Type your message to begin...",onKeyDown:e=>{"Enter"!==e.key||e.shiftKey||(e.preventDefault(),T())}}),(0,r.jsx)("button",{className:"send-btn",disabled:g,onClick:T,children:"Send"})]})]})})]})]})},{})}))}},t={};function s(r){var a=t[r];if(void 0!==a)return a.exports;var n=t[r]={exports:{}};return e[r](n,n.exports,s),n.exports}s.m=e,s.o=(e,t)=>Object.prototype.hasOwnProperty.call(e,t),(()=>{var e=[];s.O=(t,r,a,n)=>{if(r){n=n||0;for(var i=e.length;i>0&&e[i-1][2]>n;i--)e[i]=e[i-1];e[i]=[r,a,n];return}for(var o=1/0,i=0;i<e.length;i++){for(var[r,a,n]=e[i],l=!0,d=0;d<r.length;d++)(!1&n||o>=n)&&Object.keys(s.O).every(e=>s.O[e](r[d]))?r.splice(d--,1):(l=!1,n<o&&(o=n));if(l){e.splice(i--,1);var c=a();void 0!==c&&(t=c)}}return t}})(),(()=>{var e={410:0};s.O.j=t=>0===e[t];var t=(t,r)=>{var a,n,[i,o,l]=r,d=0;if(i.some(t=>0!==e[t])){for(a in o)s.o(o,a)&&(s.m[a]=o[a]);if(l)var c=l(s)}for(t&&t(r);d<i.length;d++)n=i[d],s.o(e,n)&&e[n]&&e[n][0](),e[n]=0;return s.O(c)},r=self.webpackChunklocal_chatbot_front=self.webpackChunklocal_chatbot_front||[];r.forEach(t.bind(null,0)),r.push=t.bind(null,r.push.bind(r))})();var r=s.O(void 0,["783"],function(){return s(52)});r=s.O(r)})();